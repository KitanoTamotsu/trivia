trivia.alfredworkflowのメモ

機能：
トリビアの泉のランダム表示
元ネタは、『トリビアの泉パーフェクトデータベース』（ https://www.noncky.net/trivia/ ）から取得しました

インストール：
　.alfredworkflowをダウンロード
　ファイルをダブルクリックしてワークフローに登録

使い方：
　キーワードtriviaを入力

開発メモ：


1.HTMLをパースしない

　『トリビアの泉パーフェクトデータベース』を見つけた時に
　Lesson14のRSSマニアライクなワークフローを作ろうと思い立ちました
　ただ、この番組はもう終わっていて、トリビアの追加もないので
　全てのトリビア1029個をスクリプトに埋め込みました
　そう、おバカスクリプトです
　文字列をスペース区切りで書いて、（）で括って、配列に格納しています
　

2.ランダムに9件を選んでAlfredフォーマットに出力する

　shufコマンドを利用します。ない方はインストールしてください
　またインストール先をScript Filterの先頭部分のPATHに定義してください
（私はhomebrewでインストールしています）

　shufコマンドはシャッフルです
　下記は0から1028までをシャッフルして先頭の9個をix配列に格納します
　ix=(`seq 0 1028| shuf| head -n 9`)

　後は配列ixの要素を回してJSONをセットしています


2.Safariで閲覧しているURLからソースを取得する

　URLはアップルスクリプトで取得します
　今回は、cURLで処理できるように、feed://を削除しています

　url=`osascript -e 'tell app "safari" to get the url of the current tab of window 1'|sed  's/feed://g'`


3.終了タグで改行する

　出力用の整形として終了タグで改行するようにしました
　具体的には、終了タグ">"と開始タグ"<"の間に改行"\n"を挿入しています
　また、先頭に取得したURLを表示させています

　echo -e "curl -sL "$url"\n\n"$res|sed 's/> </>\'\n' </g'


背景:

　LESSON14のRSSマニアで数多くのRSSやHTMLのソースを解析したのでツールを作ってしまいました
　https://github.com/KitanoTamotsu/rssmania
  
　このワークフローのアイコンは、もちろん、ソースがビュー
　
